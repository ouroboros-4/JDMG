(function(a){JDMG_DungeonDoor=function(k,f,b,e,l,d,h,j,g,c){this.dun=f;if((!e)||e<0){e=0}if(e>this.dun.map.default_door_position){e=this.dun.map.default_door_position}this.id=k;this.state=b;this.position=e;this.islocked=l;this.doortimer=null;this.unlockswith=null;this.innerGraphic=d;this.innerGraphic2=null;this.innerGraphic3=null;this.dir=h;this.x=j;this.y=g};JDMG_DungeonDoor.prototype.get_version=function(){return"1.0"};JDMG_DungeonDoor.prototype.opendoor=function(b,g){var f=this.dun;var d=f.map.get_map();var e=this;e.door_count=0;f.trace("JDMG_DungeonDoor:opendoor() start.");try{clearInterval(d[b][g].door.doortimer)}catch(c){this.dun.dbg(c)}if(d[b][g].door.position>0){d[b][g].door.doortimer=setInterval(function(){if(((e.door_count++)%3)==1){f.sound_effect(26)}d[b][g].door.position=d[b][g].door.position-30;this.dun.g_door.updateDoor();this.dun.dbg(d[b][g].door.position.toString());if(d[b][g].door.position-30<0){d[b][g].door.position=0;this.dun.g_door.updateDoor();clearInterval(d[b][g].door.doortimer);d[b][g].door.doortimer=null}},150)}};JDMG_DungeonDoor.prototype.closedoor=function(b,g){var f=this.dun;var d=f.map.get_map();var e=this;e.door_count=0;f.trace("JDMG_DungeonDoor:closedoor() start.");try{clearInterval(d[b][g].door.doortimer)}catch(c){}if(d[b][g].door.position!=166){d[b][g].door.doortimer=setInterval(function(){if(((e.door_count++)%3)==1){f.sound_effect(26)}d[b][g].door.position=d[b][g].door.position+30;this.dun.g_door.updateDoor();this.dun.dbg(d[b][g].door.position.toString());if(d[b][g].door.position+30>166){d[b][g].door.position=166;this.dun.g_door.updateDoor();clearInterval(d[b][g].door.doortimer);d[b][g].door.doortimer=null}},150)}};JDMG_DungeonDoor.prototype.openclose=function(b,e){var d=this.dun;var c=d.map.get_map();if(!b||!e){b=this.x;e=this.y}if(c[b][e].door.position>0){c[b][e].door.opendoor(b,e)}else{c[b][e].door.closedoor(b,e)}};JDMG_DungeonDoor.prototype.manualposition=function(b,h,g){var f=this.dun;var d=f.map.get_map();var e=this;e.door_count=0;f.trace("JDMG_DungeonDoor:manualposition("+b+","+h+")pos="+g+". doorposition="+d[b][h].door.position);try{clearInterval(d[b][h].door.doortimer)}catch(c){this.dun.dbg(c)}if(d[b][h].door.position>g){d[b][h].door.doortimer=setInterval(function(){f.trace("JDMG_DungeonDoor:manualposition("+b+","+h+")pos="+g+". (1)Intervel="+((e.door_count++)%3));if(((e.door_count++)%3)==1){f.sound_effect(26)}d[b][h].door.position=d[b][h].door.position-30;this.dun.g_door.updateDoor();this.dun.dbg(d[b][h].door.position.toString());if(d[b][h].door.position-30<g){d[b][h].door.position=g;this.dun.g_door.updateDoor();clearInterval(d[b][h].door.doortimer);d[b][h].door.doortimer=null}},150)}if(d[b][h].door.position<g){d[b][h].door.doortimer=setInterval(function(){f.trace("JDMG_DungeonDoor:manualposition("+b+","+h+")pos="+g+". (2)Intervel="+((e.door_count++)%3));if(((e.door_count++)%3)==1){f.sound_effect(26)}d[b][h].door.position=d[b][h].door.position+30;this.dun.g_door.updateDoor();this.dun.dbg(d[b][h].door.position.toString());if(d[b][h].door.position+30>g){d[b][h].door.position=g;this.dun.g_door.updateDoor();clearInterval(d[b][h].door.doortimer);d[b][h].door.doortimer=null}},150)}}}(window));(function(d){JDMG_DungeonMovement=function(e){this.dun=e};JDMG_DungeonMovement.prototype.get_version=function(){return"1.0"};JDMG_DungeonMovement.prototype.moveMe=function(g){var l=this.dun;var h=l.map.get_map();var k=l.curX;var j=l.curY;if(l.finished){return}var f=h[l.curX][l.curY];if(f.type==2||f.type==3){if(l.prevent_side_stepping_on_stairs){if(g=="d"){return l.into_stairs(f)}if(g!="u"){return}}else{if(g=="r90"||g=="l90"){return}}}var e=0;switch(g){case"u":e=c(this.dun,0);break;case"r":e=c(this.dun,-90);break;case"d":e=c(this.dun,180);break;case"l":e=c(this.dun,90);break;case"r90":a(this.dun);break;case"l90":b(this.dun);break}f=h[l.curX][l.curY];if(f.type==2||f.type==3){if(g!="r90"&&g!="l90"&&(k!=l.curX||j!=l.curY)){l.into_stairs(f);return}}this.dun.update(e)};function b(e){if(e.curDir>0){e.curDir--}else{e.curDir=3}e.update_vec()}function a(e){if(e.curDir<3){e.curDir++}else{e.curDir=0}e.update_vec()}function c(k,h){var l=k.map.get_map();var g=0;var e=0;var f={};k.calculate_vec(k.vx,k.vy,h,f);var n=f.x;var m=f.y;delete f;if(k.map.is_overflow(k.curX+n,k.curY+m)){k.trace("Movement.go();Outside("+(k.curX+n)+", "+(k.curY+m)+")");e=1}else{var j=l[k.curX+n][k.curY+m].door;if(j&&j.position>0){k.trace("Movement.go();Closed door("+(k.curX+n)+", "+(k.curY+m)+")");e=1}else{switch(l[k.curX+n][k.curY+m].type){case 1:k.trace("Movement.go();Hit Wall("+(k.curX+n)+", "+(k.curY+m)+")");e=1;break;case 2:case 3:case 0:k.curX+=n;k.curY+=m;g=1;break;default:break}}}switch(l[k.curX][k.curY].type){default:break;case 9999:if(e){}else{}break}if(e){k.sound_effect(27)}if(g){k.g_disp.doStep(k.curDir)}return g}}(window));(function(g){JDMG_GraphicsDisplay=function(m){this.dun=m;this.wall_div_name=[["","Side0_1","Front0","Side0_2",""],["","Side1_1","Front1","Side1_2",""],["","Side2_1","Front2","Side2_2",""],["","Side3_1","Front3","Side3_2",""]];this.wall_div_name_side=[["","Lside0","","Rside0",""],["","Lside1","","Rside1",""],["L2side2","Lside2","","Rside2","R2side2"],["L2side3","Lside3","","Rside3","R2side3"]];this.decor_img_name=[["","","","",""],["","Front1","Front1","Front1",""],["","Front2","Front2","Front2",""],["","Front2","Front2","Front2",""]];this.decor_img_name_side=[["","LSide0","","RSide0",""],["","LSide1","","RSide1",""],["LSide1","LSide1","","RSide1","RSide1"],["LSide1","LSide1","","RSide1","RSide1"]]};JDMG_GraphicsDisplay.prototype.get_version=function(){return"1.0"};JDMG_GraphicsDisplay.prototype.updateViewport=function(){var o=this.dun;var p=o.map.get_map();var s;var r;j(this);for(s=-2;s<=2;s++){for(r=3;r>=0;r--){var m={};var n=this.wall_div_name[r][s+2];o.calculate_vec(s,-1*r,o.get_rotation(),m);if(o.map.is_overflow(o.curX+m.x,o.curY+m.y)){if(n){o.g_disp.disblock(".wall"+n)}continue}if(r==0&&s==0){continue}if(r<2&&(s==2||s==-2)){continue}var q=this.wall_div_name_side[r][s+2];if(n||q){var u=p[o.curX+m.x][o.curY+m.y];switch(u.type){case 0:case 2:case 3:if(n){o.g_disp.hideblock(".wall"+n)}if(q){o.g_disp.hideblock(".wall"+q)}break;case 1:if(n){o.g_disp.disblock(".wall"+n)}if(q){o.g_disp.disblock(".wall"+q)}break}}if(s>-2&&s<2){b(this,s,r,m)}}}var t=p[o.curX][o.curY];if(t){if(t.door){c(this,t)}else{if(t.type==2||t.type==3){k(this,t)}}}this.dun.g_door.updateDoor()};function l(t,w,o,v,u,n){var r=t.dun;var p;var m=1;if(v!=0&&u<=2&&u>=0){var s=r.map.get_map();var w=s[r.curX+n.x+r.vx][r.curY+n.y+r.vy];if(w&&w.type==1){var q=u+1;if(v==-1){o=".wallSide"+(q)+"_1_walldecor";p="doorLSide"+q+".png"}if(v==1){o=".wallSide"+(q)+"_2_walldecor";p="doorRSide"+q+".png"}e(o,r.root_path+"/_img/"+p,{side:v,dist:q,front:m})}}}function a(u,r,o,y,v,n){var s=u.dun;var q="";if(r.type==2){q="Stairsup"}else{q="Stairsdown"}var p;var m=0;if(y==0){p=q+"_Front"+v+".png";e(o,s.root_path+"/_img/stairs/"+p,{side:y,dist:v})}else{if(v==0){o=".wall"+u.wall_div_name[v+1][y+2]+"_walldecor";if(y==1){e(o,s.root_path+"/_img/stairs/Side0R.png",{side:y,dist:v})}else{if(y==-1){e(o,s.root_path+"/_img/stairs/Side0L.png",{side:y,dist:v})}}}else{var t=s.map.get_map();var z=t[s.curX+(s.vx*v)][s.curY+(s.vy*v)];if(h(z.type)){m=1;p=q+"_Front"+v+".png";if(v==3&&y==-1){o=".wallSide"+v+"_1";p=q+"_Front"+3+".png"}if(v==3&&y==1){o=".wallSide"+v+"_2";p=q+"_Front"+3+".png"}if(v==2&&y==-1){o=".wallSide"+v+"_1_walldecor";p=q+"_Side2_1.png";m=2}if(v==2&&y==1){o=".wallSide"+v+"_2_walldecor";p=q+"_Side2_2.png";m=2}if(v==1&&y==-1){o=".wallSide"+v+"_1_walldecor";p=q+"_Side"+v+".png"}if(v==1&&y==1){o=".wallSide"+v+"_2_walldecor";p=q+"_Side"+v+".png"}e(o,s.root_path+"/_img/stairs/"+p,{side:y,dist:v,front:m})}else{var w=0;if(!s.map.is_overflow(s.curX+n.x-1,s.curY+n.y)){w+=t[s.curX+n.x-1][s.curY+n.y].type}if(!s.map.is_overflow(s.curX+n.x+1,s.curY+n.y)){w+=t[s.curX+n.x+1][s.curY+n.y].type}if(!s.map.is_overflow(s.curX+n.x,s.curY+n.y-1)){w+=t[s.curX+n.x][s.curY+n.y-1].type}if(!s.map.is_overflow(s.curX+n.x,s.curY+n.y+1)){w+=t[s.curX+n.x][s.curY+n.y+1].type}if(w>0){p=q+"_Side"+v+".png";o=".wall"+u.wall_div_name_side[v][y+2]+"_walldecor";if(y==1){p=q+"_Side2R.png"}if(y==-1){p=q+"_Side2L.png"}e(o,s.root_path+"/_img/stairs/"+p,{side:y,dist:v,front:m})}}}}s.trace("GraphicsDisplay:stairs():stairs_cell.type="+r.type+"(vx="+y+", vy="+v+"):dir="+q+", div="+o+", file="+p+", front="+m)}function k(p,m){var o=p.dun;var n="";if(m.type==2){n="Stairsup"}else{n="Stairsdown"}e(".wallFront0_walldecor",o.root_path+"/_img/stairs/"+n+"_Front0.png",{side:0,dist:-1});if(o.prevent_side_stepping_on_stairs){o.html.move_ctl_box_hide("all_side")}else{o.html.move_ctl_box_hide("turn_mask")}}function c(q,m){var p=q.dun;var o=p.map.get_map();var n=o[p.curX+p.vx][p.curY+p.vy];p.trace("GraphicsDisplay:on_door():(vx="+p.vx+", vy="+p.vy+"): type="+n.type);if(h(n.type)){e(".wallFront0_walldecor",p.root_path+"/_img/doorfront0.png",{side:0,dist:-1})}}function f(r,o,n,q){q.dir=new Array("","");q.front=new Array(0,0);var m=q.dir;var p=q.front;switch(r.curDir){default:case 0:if(o!=0&&n>=2){m[0]="s";p[0]=1;if(o==1){m[1]="w"}else{m[1]="e"}}else{if(o==0){m[0]="s";p[0]=1}else{if(o==1){m[0]="w"}else{m[0]="e"}}}break;case 1:if(o!=0&&n>=2){m[0]="w";p[0]=1;if(o==1){m[1]="n"}else{m[1]="s"}}else{if(o==0){m[0]="w";p[0]=1}else{if(o==1){m[0]="n"}else{m[0]="s"}}}break;case 2:if(o!=0&&n>=2){m[0]="n";p[0]=1;if(o==1){m[1]="e"}else{m[1]="w"}}else{if(o==0){m[0]="n";p[0]=1}else{if(o==1){m[0]="e"}else{m[0]="w"}}}break;case 3:if(o!=0&&n>=2){m[0]="e";p[0]=1;if(o==1){m[1]="s"}else{m[1]="n"}}else{if(o==0){m[0]="e";p[0]=1}else{if(o==1){m[0]="s"}else{m[0]="n"}}}break}return}function b(u,z,y,o){var s=u.dun;var v=s.map.get_map();var A="wall"+u.decor_img_name[y][z+2]+"_text.png";var p="wall"+u.decor_img_name_side[y][z+2]+"_text.png";var n=".wall"+u.wall_div_name[y][z+2]+"_walldecor";var t=".wall"+u.wall_div_name_side[y][z+2]+"_walldecor";if(n||t){var r={};f(s,z,y,r);var q=r.dir;var m=r.front;var B=v[s.curX+o.x][s.curY+o.y];switch(B.type){case 2:case 3:a(u,B,n,z,y,o);return}if(B.door){l(u,B,n,z,y,o);return}for(var w=0;w<2;w++){if(q[w]&&B[q[w]]&&B[q[w]].length>0){for(x in B[q[w]]){switch(B[q[w]][x].objType){case"wallText":if(z==0&&y==1){$(".wallFront1").html(B[q[w]][x].text)}else{if(z==0&&y>1){e(n,s.root_path+"/_img/"+A,{side:z,dist:y})}else{if(z==1||z==-1){if(y==0){e(t,s.root_path+"/_img/"+p,{side:z,dist:y})}else{if(m[w]){if(y>=2){e(n,s.root_path+"/_img/"+A,{side:z,dist:y,front:1})}}else{e(t,s.root_path+"/_img/"+p,{side:z,dist:y})}}}}}break}}}}}}JDMG_GraphicsDisplay.prototype.doStep=function(m){this.dun.checkEvent(m);$("div[class*='side'], div[class*='Side'], .floor, .roof").each(function(n){var o=$(this).css("background-image");if(o.indexOf("alt")==-1){$(this).css("background-image",o.replace("nor.","alt."))}else{$(this).css("background-image",o.replace("alt.","nor."))}})};JDMG_GraphicsDisplay.prototype.clearevents=function(m){$(m).unbind()};JDMG_GraphicsDisplay.prototype.disblock=function(m){$(m).css("display","block")};JDMG_GraphicsDisplay.prototype.hideblock=function(m){$(m).css("display","none")};function e(o,m,n){$(o).css("background-image","url("+m+")");$(o).css("display","block");if(n){if(n.side){if(n.dist==-1){$(o).css("background-size","448px 272px")}else{if(n.dist==0){$(o).css("background-size","64px 272px")}else{if(n.dist==1){if(n.front){$(o).css("background-size","64px 222px")}else{$(o).css("background-size","56px 222px")}}else{if(n.dist==2){if(n.front){$(o).css({"background-size":"208px 142px"})}else{$(o).css("background-size","28px 142px")}}else{if(n.dist==3){$(o).css("background-size","148px 102px")}}}}}}else{if(n.dist==1){$(o).css("background-size","320px 222px")}else{if(n.dist==2){$(o).css("background-size","208px 142px")}else{if(n.dist==3){$(o).css("background-size","152px 102px")}}}}}}function j(m){$(".wallFront1").html("");$(".wallFront1").css("background-image","");$(".wallSide3_1").css("background-image","");$(".wallSide3_2").css("background-image","");$("div[class*=decor]").css("background-image","");$("div[class*=decor]").css("display","none");$("div[class*=door]").css("display","none");m.clearevents(".doorFront1_button");m.clearevents(".doorFront2_button");m.clearevents(".doorSide2_1_button");m.dun.html.move_ctl_box_show("all_side")}function d(){}JDMG_GraphicsDisplay.prototype.tmpLightswitch=function(){this.dun.trace("JDMG_GraphicsDisplay.tmpLightswitch().");var m="#"+this.dun.html.get_overlay_div_id();if($(m).css("display")=="block"){$(m).css("display","none")}else{$(m).css("display","block")}};JDMG_GraphicsDisplay.prototype.Set_LightLevel=function(n){var m="#"+this.dun.html.get_overlay_div_id();if(n>10){$(m).css("opacity",0);$(m).css("display","none")}else{$(m).css("display","block");if(n>1){$(m).css("opacity",(1-(n/10)))}else{$(m).css("opacity",1)}}this.dun.trace("JDMG_GraphicsDisplay.Set_LightLevel("+n+") -> opacity:"+(1-(n/10)))};function h(m){if(m==1){return 1}return 0}}(window));(function(a){JDMG_Graphics_HTML=function(c,b){this.dun=c;this.div_id=b};JDMG_Graphics_HTML.prototype.get_version=function(){return"1.0"};JDMG_Graphics_HTML.prototype.draw=function(){var b=this.dun.user;$(this.div_id).html("");$(this.div_id).append("<div id='dungeon_terrain_inner'>");$(this.div_id).append("<span id='dungeon_header' style='color:#fff;'></span><br/>");$(this.div_id).append("<div style='top:30px;margin-left:auto;margin-right:auto;'>");$(this.div_id).append(this.get_compass_box());$(this.div_id).append(this.get_main_viewport());$(this.div_id).append("<div style='display:inline-block;width:500px;'>");$(this.div_id).append(this.get_map());$(this.div_id).append(this.get_move_ctl_box());$(this.div_id).append("</div>");$(this.div_id).append("</div>");$(this.div_id).append(this.get_help());$(this.div_id).append(this.get_debug_box());$(this.div_id).append("<div style='clear:both;'></div>");$(this.div_id).append("</div>");$(this.div_id).append(this.get_css());var c=this;$(document).ready(function(){c.vpWidth=448;c.vpHeight=272;$("#jdmg_viewport").css("width",c.vpWidth);$("#jdmg_viewport").css("height",c.vpHeight)})};JDMG_Graphics_HTML.prototype.update_header=function(b){$("#dungeon_header").html(b)};JDMG_Graphics_HTML.prototype.get_map_div_id=function(){return"jdmg_map"};JDMG_Graphics_HTML.prototype.get_compass_div_id=function(){return"jdmg_compass"};JDMG_Graphics_HTML.prototype.get_help_div_id=function(){return"jdmg_help_box"};JDMG_Graphics_HTML.prototype.get_overlay_div_id=function(){return"jdmg_overLay"};JDMG_Graphics_HTML.prototype.get_help=function(e){var c="";var b="";if(!e){var d="position:fixed;right:40%;top:20%;";c='<div id="jdmg_help_box" style="background:#000;'+d+'">';b="</div>"}return c+"<table width=450><tr><td>Up</td><td><span>w (↑)</span></td></tr><tr><td>Down</td><td><span>s (↓)</span></td></tr><tr><td>Left 90*</td><td><span>q (←)</span></td></tr><tr><td>Right 90*</td><td><span>e (→)</span></td></tr><tr><td>Left</td><td><span>a (Ctl/Sft + ←)</span></td></tr><tr><td>Right</td><td><span>d (Ctl/Sft + →)</span></td></tr></table>"+b};JDMG_Graphics_HTML.prototype.get_debug_box=function(){var b="position:fixed;right:10%;top:20%;";return'<div id="jdmg_debugwindow" style="background:#000;'+b+'">Debug:<span id="dbug"></span></div>'};JDMG_Graphics_HTML.prototype.get_map=function(){return'<div id="jdmg_map" style="color:white; font-size:8px;line-height:6px; width:200px; height:200px;display:none;"></div>'};JDMG_Graphics_HTML.prototype.get_main_viewport=function(){var b=this.dun.root_path;return'<div id="jdmg_viewport" style="margin-left:30px;width:500px;overflow:hidden;float:left;"><div id="jdmg_illust" style="pointer-events: none;"></div><div id="jdmg_overLay" style="pointer-events: none;"></div><div class="roof"></div><div class="floor"></div><div class="wallFront0_walldecor" style="pointer-events: none;"></div><div class="wallFront1_walldecor"></div><div class="wallLside0"></div><div class="wallLside0_walldecor"></div><div class="wallLside1"></div><div class="wallLside1_walldecor"></div><div class="wallLside2"></div><div class="wallLside2_walldecor"></div><div class="wallLside3"></div><div class="wallL2side2"></div><div class="wallL2side3"></div><div class="wallRside0"></div><div class="wallRside0_walldecor"></div><div class="wallRside1"></div><div class="wallRside1_walldecor"></div><div class="wallRside2"></div><div class="wallRside2_walldecor"></div><div class="wallRside3"></div><div class="wallR2side2"></div><div class="wallR2side3"></div><div class="wallSide1_1"></div><div class="doorSide1_1"><div class="doorSide1_1_inner"></div></div><div class="doorSide1_2"><div class="doorSide1_2_inner"></div></div><div class="wallFront1"></div><div class="doorFront1"><div class="doorFront1_inner"></div></div><div class="doorFront1_button"></div><div class="wallSide1_2"></div><div class="wallSide2_1"></div><div class="doorSide2_1"><div class="doorSide2_1_inner"></div></div><div class="wallSide1_1_walldecor"></div><div class="wallSide2_1_walldecor"></div><div class="wallFront2"></div><div class="wallFront2_walldecor"></div><div class="doorFront2"><div class="doorFront2_inner"></div></div><div class="wallSide2_2"></div><div class="doorSide2_2"><div class="doorSide2_2_inner"></div></div><div class="wallSide1_2_walldecor"></div><div class="wallSide2_2_walldecor"></div><div class="doorFront2_button"></div><div class="doorSide2_1_button"></div><div class="doorFront3_button"></div><div class="doorSide3_1_button"></div><div class="doorSide3_2_button"></div><div class="doorFront3"><div class="doorFront3_inner"></div></div><div class="doorSide3_1"><div class="doorSide3_1_inner"></div></div><div class="doorSide3_2"><div class="doorSide3_2_inner"></div></div><div class="wallSide3_1"></div><div class="wallSide3_1_walldecor"></div><div class="wallFront3"></div><div class="wallFront3_walldecor"></div><div class="wallSide3_2"></div><div class="wallSide3_2_walldecor"></div></div>'};JDMG_Graphics_HTML.prototype.get_move_ctl_box=function(){var b=this.dun.root_path;return"<table id='jdmg_movement_ctl_box' class='ctl_btn_table' style='margin-top:20px;margin-left:auto;margin-right:auto;'><tr><td><div name='side_turn_ctl' onclick=\"dun.mov.moveMe(this.getAttribute('dir'))\" dir='l90' style='display:inline-block;width:96px;height:76px;background-image:url(\""+b+"/_MainGFX/l90.png\")'></div></td><td ><div onclick=\"dun.mov.moveMe(this.getAttribute('dir'))\" dir='u' style='display:inline-block;width:96px;height:76px;background-image:url(\""+b+"/_MainGFX/u.png\")'></div></td><td ><div name='side_turn_ctl' onclick=\"dun.mov.moveMe(this.getAttribute('dir'))\" dir='r90' style='display:inline-block;width:96px;height:76px;background-image:url(\""+b+"/_MainGFX/r90.png\")'></div></td></tr><tr><td><div name='side_move_ctl' onclick=\"dun.mov.moveMe(this.getAttribute('dir'))\" dir='l' style='display:inline-block;width:96px;height:76px;background-image:url(\""+b+"/_MainGFX/l.png\")'></div></td><td><div onclick=\"dun.mov.moveMe(this.getAttribute('dir'))\" dir='d' style='display:inline-block;width:96px;height:76px;background-image:url(\""+b+"/_MainGFX/d.png\")'></div></td><td><div name='side_move_ctl' onclick=\"dun.mov.moveMe(this.getAttribute('dir'))\" dir='r' style='display:inline-block;width:96px;height:76px;background-image:url(\""+b+"/_MainGFX/r.png\")'></div></td></tr></table>"};JDMG_Graphics_HTML.prototype.move_ctl_box_hide=function(b){if(b=="full"){$("#jdmg_movement_ctl_box").hide()}if(b=="side_mask"||b=="all_side"){$("div[name=side_move_ctl]").html("<div style='width:96px;height:76px;background-color:rgba(0,0,0,0.5);'></div>")}if(b=="turn_mask"||b=="all_side"){$("div[name=side_turn_ctl]").html("<div style='width:96px;height:76px;background-color:rgba(0,0,0,0.5);'></div>")}};JDMG_Graphics_HTML.prototype.move_ctl_box_show=function(b){if(b=="full"){$("#jdmg_movement_ctl_box").show()}if(b=="side_mask"||b=="all_side"){$("div[name=side_move_ctl]").html("")}if(b=="turn_mask"||b=="all_side"){$("div[name=side_turn_ctl]").html("")}};JDMG_Graphics_HTML.prototype.get_compass_box=function(){var d=this.dun.root_path;var f=this.get_help(1);var c="";if(this.dun.is_debug()){c="<input name='dmj_btn' type='button' onclick=\"dun.my_alert(dun.curX+','+dun.curY)\" value=\"Where?\" /><input name='dmj_btn' type='button' value='Debug' style='display:inline;' onclick=\"dun.toggle_div('#jdmg_debugwindow');\"/>"}var b="none";if(this.dun.user.automap>0){b="inline"}var e="<input id='jdmg_map_btn' name='dmj_btn' type='button' value='Map' style='display:"+b+';\' onclick="dun.toggle_map();dun.map.draw_map();"/>';return'<div id="jdmg_sidewin" style="margin-left:20px;width:130px;height:290px;float:left;"><div>'+c+"<br/>"+e+"<input name='dmj_btn' type='button' value='Help' onclick=\"dun.my_help('"+f+"');\"/><div style='position:relative;'><div id='jdmg_compass'><div style='position:relative;display:inline-block;margin:auto;margin-top:30px;text-align:center;vartical-align:middle;'><img id='jdmg_compass_back' src='"+d+"/_MainGFX/compass.png?0' style='position:absolute;top:-72px;left:-66px;margin:auto;'><img id='jdmg_compass_arrow' src='"+d+"/_MainGFX/arrow.png?0' style='position:absolute;top:-72px;left:-66px;margin:auto;'><img src='"+d+"/_MainGFX/null.gif' style='position:absolute;top:-72px;left:-66px;margin:auto;width:130px;height:130px'><div id='jdmg_compass_txt' class='black_edge transparent white' style='position:absolute;top:-27px;left:-21px; color:#fff; font-size:24px;line-height:36px;width:36px;height:36px;'>Ｎ</div></div></div></div></div>"};JDMG_Graphics_HTML.prototype.get_css=function(){var b=this.dun.root_path;return' <link href="'+b+'/_css/main.css?5" rel="stylesheet"/><style type="text/css">.floor {position:absolute;bottom:0px;background-image:url("'+b+'/_img/floornor.png");width:448px;height:140px;}.roof {position:absolute;top:0px;background-image:url("'+b+'/_img/roofnor.png");width:448px;height:58px;}.wallRside0 {position:absolute;right:0px;background-image:url("'+b+'/_img/wallRSide0nor.png");width:64px;height:272px;z-index:401;display:none;}.wallLside0 {position:absolute;left:0px;background-image:url("'+b+'/_img/wallLSide0nor.png");width:64px;z-index:401;height:272px;display:none;}.wallRside1 {position:absolute;right:64px;top:18px;background-image:url("'+b+'/_img/wallRSide1nor.png");width:56px;height:222px;z-index:301;display:none;}.wallLside1 {position:absolute;left:64px;top:18px;background-image:url("'+b+'/_img/wallLSide1nor.png");width:56px;height:222px;z-index:301;display:none;}.wallRside2 {position:absolute;right:120px;top:40px;background-image:url("'+b+'/_img/wallRSide2nor.png");width:28px;height:142px;z-index:201;display:none;}.wallLside2 {position:absolute;	left:120px;	top:40px;background-image:url("'+b+'/_img/wallLSide2nor.png");;width:28px;height:142px;z-index:201;display:none;}.wallRside3 {position:absolute;right:148px;top:49px;background-image:url("'+b+'/_img/wallRSide3nor.png");width:22px;height:102px;z-index:101;display:none;}.wallLside3 {position:absolute;left:148px;top:49px;background-image:url("'+b+'/_img/wallLSide3nor.png");width:22px;height:102px;z-index:101;display:none;}.wallR2side2 {position:absolute;right:-14px;top:40px;background-image:url("'+b+'/_img/wallRSide2nor.png");width:28px;height:142px;z-index:200;display:none;}.wallL2side2 {position:absolute;left:-14px;top:40px;background-image:url("'+b+'/_img/wallLSide2nor.png");;width:28px;height:142px;z-index:200;display:none;}.wallR2side3 {position:absolute;right:0px;top:49px;background-image:url("'+b+'/_img/wallR2Side3.png");width:36px;height:102px;z-index:100;display:none;}.wallL2side3 {position:absolute;left:0px;top:49px;background-image:url("'+b+'/_img/wallL2Side3.png");width:36px;height:102px;z-index:100;display:none;}.wallFront1 {position:absolute;left:64px;top:18px;background-image:url("'+b+'/_img/wallFront1nor.png");width:320px;height:222px;z-index:301;display:none;}.wallSide1_1 {position:absolute;left:0px;top:18px;background-image:url("'+b+'/_img/wallSide1nor.png");width:64px;height:222px;z-index:301;display:none;}.wallSide1_2 {position:absolute;right:0px;top:18px;background-image:url("'+b+'/_img/wallSide1alt.png");width:64px;height:222px;z-index:301;display:none;}.wallSide1_1_walldecor {position:absolute;left:0px;top:18px;width:64px;height:222px;z-index:302;display:none;background-position: center;}.wallSide1_2_walldecor {position:absolute;right:0px;top:18px;width:64px;height:222px;z-index:302;display:none;background-position: center;}.wallFront2 {position:absolute;left:120px;top:40px;background-image:url("'+b+'/_img/wallFront2nor.png");width:208px;height:142px;z-index:201;display:none;}.wallSide2_1 {position:absolute;left:0px;top:40px;background-image:url("'+b+'/_img/wallSide2nor.png");width:120px;height:142px;z-index:201;display:none;}.wallSide2_2 {position:absolute;right:0px;top:40px;background-image:url("'+b+'/_img/wallSide2alt.png");width:120px;height:142px;z-index:201;display:none;}.wallSide2_1_walldecor {position:absolute;left:-88px;top:40px;width:208px;height:142px;z-index:202;display:none;background-position: center;}.wallSide2_2_walldecor {position:absolute;right:-88px;top:40px;width:208px;height:142px;z-index:202;display:none;background-position: center;}.wallFront3 {position:absolute;right:148px;top:49px;background-image:url("'+b+'/_img/wallFront3nor.png");width:152px;height:102px;z-index:101;display:none;}.wallSide3_1 {position:absolute;left:0px;top:49px;background-image:url("'+b+'/_img/wallSide3nor.png");width:148px;height:102px;z-index:101;display:none;}.wallSide3_2 {position:absolute;right:0px;top:49px;background-image:url("'+b+'/_img/wallSide3nor.png");width:148px;height:102px;z-index:101;display:none;}.wallSide3_1_walldecor {position:absolute;left:0px;top:49px;width:148px;height:102px;z-index:102;display:none;background-position: center;}.wallSide3_2_walldecor {position:absolute;right:0px;top:49px;width:148px;height:102px;z-index:102;display:none;background-position: center;}.wallfrontTEXT{color:#3f3225;font-weight:bold;font-size:18px; margin-top:18%; text-align:center;  margin-left:70px; width:180px;font-family:Palatino Linotype, Book Antiqua, Palatino, serif;}.wallLside0_walldecor {position:absolute;left:0px;width:64px;z-index:402;height:272px;display:none;background-position: left;}.wallRside0_walldecor {position:absolute;right:0px;width:64px;z-index:402;height:272px;display:block;background-position: right;}.wallLside1_walldecor {position:absolute;left:64px;top:18px;width:56px;height:222px;z-index:302;display:none;background-position: left;}.wallRside1_walldecor {position:absolute;right:64px;top:18px;width:56px;height:222px;z-index:302;display:none;background-position: right;}.wallLside2_walldecor {position:absolute;left:120px;top:40px;width:28px;height:142px;z-index:202;display:none;}.wallRside2_walldecor {position:absolute;right:120px;top:40px;width:28px;height:142px;z-index:202;display:none;}.doorFront1 {position:absolute;left:95px;top:30px;width:320px;height:222px;z-index:302;display:none;background-image:url("'+b+'/_img/doorFront1.png");background-repeat:no-repeat;}.doorFront1_inner {left:39px;width:181px;height:166px;display:none;position:absolute;top:6px;background-image:url("'+b+'/_img/door/Wooden.png");background-position:bottom;}.doorFront2 {position:absolute;left:135px;top:47px;width:175px;height:140px;z-index:202;display:none;background-image:url("'+b+'/_img/doorFront2.png");background-repeat:no-repeat;}.doorFront2_inner {left:25px;width:122px;height:111px;display:none;position:absolute;top:4px;background-image:url("'+b+'/_img/door/Wooden.png");background-position:bottom;background-repeat:no-repeat;}.doorFront1_button {position:absolute;right:100px;width:20px;top:80px; height:24px;background-image:url("'+b+'/_img/doorbutton.png");z-index:309;}.doorFront2_button {position:absolute;right:145px;width:10px;top:85px; height:12px;background-image:url("'+b+'/_img/doorbutton.png");z-index:209;}.doorSide2_1_button {position:absolute;right:334px;width:10px;top:85px; height:12px;background-image:url("'+b+'/_img/doorbutton.png");z-index:209;}.doorSide1_1 {position:absolute;left:0px;top:15px;width:64px;height:222px;z-index:302;display:none;background-image:url("'+b+'/_img/doorSide1.png");background-repeat:no-repeat;}.doorSide1_1_inner {left:0px;width:64px;height:166px;display:none;position:absolute;top:25px;background-image:url("'+b+'/_img/door/Wooden.png");background-position:bottom right;}.doorSide1_2 {position:absolute;right:0px;top:15px;width:64px;height:222px;z-index:202;display:none;background-image:url("'+b+'/_img/doorSide1.png");background-repeat:no-repeat;}.doorSide1_2_inner {left:0px;width:64px;height:166px;display:none;position:absolute;top:25px;background-image:url("'+b+'/_img/door/Wooden.png");background-position:bottom left;}.doorSide2_1 {position:absolute;right:328px;top:47px;width:120px;height:140px;z-index:202;display:none;background-image:url("'+b+'/_img/doorFront2.png");background-repeat:no-repeat;background-position:top right;}.doorSide2_1_inner {right:25px;width:95px;height:16px;display:none;position:absolute;top:4px;background-image:url("'+b+'/_img/door/Wooden.png");background-position:bottom right;background-repeat:no-repeat;}.doorSide2_2 {position:absolute;left:328px;top:47px;width:120px;height:140px;z-index:202;display:none;background-image:url("'+b+'/_img/doorFront2.png");background-repeat:no-repeat;}.doorSide2_2_inner {left:25px;width:96px;height:111px;display:none;position:absolute;top:4px;background-image:url("'+b+'/_img/door/Wooden.png");background-position:bottom left;background-repeat:no-repeat;}.doorFront3 {position:absolute;left:153px;top:54px;width:140px;height:92px;z-index:102;display:none;background-image:url("'+b+'/_img/doorFront3.png");background-repeat:no-repeat;}.doorSide3_1 {position:absolute;right:285px;top:54px;width:140px;height:92px;z-index:102;display:none;background-image:url("'+b+'/_img/doorFront3.png");background-repeat:no-repeat;background-position:top right;}.doorSide3_2 {position:absolute;left:285px;top:54px;width:140px;height:92px;z-index:102;display:none;background-image:url("'+b+'/_img/doorFront3.png");background-repeat:no-repeat;}.doorFront3_button {position:absolute;right:163px;width:5px;top:85px; height:6px;background-image:url("'+b+'/_img/doorbutton.png");z-index:109;}.doorSide3_1_button {position:absolute;right:293px;width:5px;top:85px; height:6px;background-image:url("'+b+'/_img/doorbutton.png");z-index:109;}.doorSide3_2_button {position:absolute;left:412px;width:5px;top:85px; height:6px;background-image:url("'+b+'/_img/doorbutton.png");z-index:109;}.doorFront3_inner {left:23px;width:95px;height:85px;display:none;position:absolute;top:4px;background-image:url("'+b+'/_img/door/Wooden.png");background-position:bottom;background-repeat:no-repeat;}.doorSide3_1_inner {right:21px;width:95px;height:85px;display:none;position:absolute;top:4px;background-image:url("'+b+'/_img/door/Wooden.png");background-position:bottom right;background-repeat:no-repeat;}.doorSide3_2_inner {left:21px;width:95px;height:85px;display:none;position:absolute;top:4px;background-image:url("'+b+'/_img/door/Wooden.png");background-position:bottom left;background-repeat:no-repeat;}.wallFront0_walldecor {position:absolute;left:0px;top:0px;width:448px;height:272px;z-index:402;display:none;background-repeat:no-repeat;}.wallFront1_walldecor {position:absolute;left:64px;top:18px;width:320px;height:222px;z-index:302;display:none;}.wallFront2_walldecor {position:absolute;left:120px;top:40px;width:208px;height:142px;z-index:202;display:none;}.wallFront3_walldecor {position:absolute;right:148px;top:49px;width:152px;height:102px;z-index:102;display:none;}#jdmg_help_box{z-index:1010;border:solid 2px #00c0c0;color:#00c0c0;display:none;}#jdmg_help_box table {color:#00c0c0 !important;}#jdmg_debugwindow{z-index:1009;font-size:10px;border:ridge 4px #00c0c0;color:#00c0c0; width:300px; height:300px; overflow:scroll;display:none;}#jdmg_map{z-index:1008; background-color:rgba(0,0,0,0); float:left; margin-left:20px;font-family:Palatino Linotype, Book Antiqua, Palatino, serif;}#jdmg_compass{margin-top:10px;margin-bottom:10px;margin-left:auto;margin-right:auto;font-family:Palatino Linotype, Book Antiqua, Palatino, serif;color:#00c0c0;padding-top:47px;width:120px;height:112px;text-align:center;vartical-align:middle;font-size:18px;}#jdmg_compass_back{}#jdmg_compass_arrow{transform-origin:50% 50%;}#jdmg_compass_txt{display:inline-block;text-align:center;vartical-align:middle;margin:auto;font-weight:bold;font-family: Hannari, Noto Sans JP, serif;border-radius:50%;-moz-border-radius:50%;-webkit-border-radius:50%;background-color:rgba(222,184,135,0.3);border:solid 2px #651900; }#dungeon_terrain_inner{font-family:Palatino Linotype, Book Antiqua, Palatino, serif;}#jdmg_viewport{position:relative;background-color:black;}input[type="button"][name="dmj_btn"]{background-color:#000000;border:solid 2px #00c0c0;color:#00c0c0}input[type="button"][name="dmj_btn"]:active {background-color:#000000;border:solid 2px #c000c0;color:#00c0c0}#jdmg_illust{position:absolute;top:0px;left:0px;width:448px;height:272px;z-index:1001;display:none;background-image:url("'+b+'/_img/mons0.png");display:none;}#jdmg_overLay{background-color:black;position:absolute;z-index:1000;opacity:0.6;filter:alpha(opacity=60);width:448px;height:272px;display:none;}#jdmg_sidewin{float:left; bottom:20px;right:20px;}#jdmg_sidewin table {border:solid 2px #00c0c0;}#jdmg_sidewin table td {border:solid 1px #00c0c0;}#jdmg_sidewin table td:active {border:solid 1px #c03600;}.ctl_btn_table div:hover{opacity:0.7;}</style>'}}(window));(function(d){JDMG_DungeonMap=function(h,g){this.map_div_id="#"+g;this.dun=h;this.default_door_position=166;this.width=0;this.height=0};JDMG_DungeonMap.prototype.get_version=function(){return"1.0"};JDMG_DungeonMap.prototype.init_current_map=function(j,k){this.curmap=new Array();for(var g=0;g<j;g++){this.curmap[g]=new Array();for(var h=0;h<k;h++){this.curmap[g][h]=new a()}}this.width=j;this.height=k};JDMG_DungeonMap.prototype.draw_map=function(){var m=this.dun;if(!m.user.automap){$(this.map_div_id).html("");m.hide_map();return}if(this.map_div_id){var j="";for(var l=0;l<this.curmap[0].length;l++){for(var h=0;h<this.curmap.length;h++){var k="visible";var g=0;if(m.floor<0){if(m.floors_d_state){if(m.floors_d_state[m.floor*-1]==1){g=1}}}else{if(m.floors_u_state){if(m.floors_u_state[m.floor]==1){g=1}}}if(m.user.automap==1&&g==0){if(this.map_mask[l*this.width+h]==0){k="hidden"}}if(h==m.curX&&l==m.curY){j+='<span style="color:red;visibility:'+k+';">■</span>'}else{switch(this.curmap[h][l].type){case 0:if(this.curmap[h][l].door){j+='<span style="color:cyan;visibility:'+k+';">□</span>'}else{j+='<span style="color:gray;visibility:'+k+';">□</span>'}break;case 1:j+='<span style="visibility:'+k+';">■</span>';break;default:j+='<span style="color:violet;visibility:'+k+';">□</span>';break}}}j+="<br/>"}$(this.map_div_id).html(j)}};function a(){this.type=0;this.n=new Array();this.e=new Array();this.s=new Array();this.w=new Array();this.onWalkover=null;this.door=null}function c(g,j,h,k){this.onEvent_hasrun=g;this.onEvent_runonce=j;this.myEvent=h;this.myCallback=k}function f(g){this.objType="wallText";this.text="<div class='wallfrontTEXT'>"+g+"</div>"}function e(j,k,h,g){}JDMG_DungeonMap.prototype.get_map=function(){return this.curmap};JDMG_DungeonMap.prototype.is_overflow=function(h,g){if(this.width>0&&this.height>0){if(h>=0&&g>=0&&h<this.width&&g<this.height){return 0}}return 1};JDMG_DungeonMap.prototype.setup=function(l,j){var o=this.dun;if(!j){j={type:"custom",index:1}}if(l){if(j.func_init){(j.func_init)(this.dun,j);if(o.event_floor>o.out_floor){o.tower=1;o.total_floors=(o.event_floor-o.out_floor-1)}else{if(o.out_floor>o.event_floor){o.total_floors=(o.out_floor-o.event_floor-1)}else{o.trace("DungeonMap:Invalid Plug-in data. event_floor(goal)="+o.event_floor+", out_floor="+o.out_floor+", start="+o.start_floor);o.out_floor=0;o.start_floor=-1;o.event_floor=-2;o.total_floors=(o.out_floor-o.event_floor-1)}}o.floor=o.start_floor;o.trace("DungeonMap: set plug-in data. event_floor(goal)="+o.event_floor+", out_floor="+o.out_floor+", start="+o.start_floor)}else{o.trace("DungeonMap: set defalt data. plug-in="+j.func_init);o.tower=j.tower;if(o.tower){o.start_floor=1;o.floor=o.start_floor;o.out_floor=0;o.event_floor=3;o.total_floors=(o.event_floor-o.out_floor-1)}else{o.start_floor=-1;o.floor=o.start_floor;o.out_floor=0;o.event_floor=-3;o.total_floors=(o.out_floor-o.event_floor-1)}}if(o.total_floors>0){o.floors_u_state=new Array();o.floors_d_state=new Array();for(var k=0;k<=o.total_floors;k++){o.floors_u_state[k]=0;o.floors_d_state[k]=0}}o.resume_saved_data()}var h="";if(j.func){h=(j.func)(this.dun,j)}else{var m=200;if((!j.width)||(!j.height)||j.width<0||j.height<0){if(j.width>m||j.height>m){j.width=m;j.height=m}else{j.width=16;j.height=16}}}if(h){o.html.update_header(h)}else{if(o.total_floors>0){if(o.floor==0){o.html.update_header("Floor: Ground")}else{if(o.floor<0){o.html.update_header("Floor: B"+(o.floor*-1))}else{o.html.update_header("Floor: "+(o.floor))}}}}switch(j.type){case"builtin":case"custom":this["create_custom_map"](l,j.index);break;case"random":this["create_random_map"](l,j.index);break}this.map_mask=new Array();for(var n=0;n<this.height;n++){for(var g=0;g<this.width;g++){this.map_mask[n*this.width+g]=0}}if(j.light){this.map_default_light=j.light}else{this.map_default_light=0}this.steps=0;this.encount_mons=0;return this.curmap};JDMG_DungeonMap.prototype.create_custom_map=function(s,u){var n=this.dun;var q=[{dir:2,x:2,y:1,cells:["00000000000000000000000000000000000","00200001111111111111111110000001110","00100000000010000000000000000001110","01111111101111101110000100111101110","01001001001000111111110111100101110","01100000011110001110010110001110100","00101111011010110000010101110011100","00111000011110111111110101011110000","01101111111111101111001101000000000","01001000011110110111111001100000100","01111011100101110111111000101111100","01001010100101111111110111101010100","00111010101101110111111100001010100","00100010001011010010000111111010200","01111110101011111010101000100010000","01000000111010000000101110111011000","01111111100010200111111011001000000","00100000000110100111110001101111100","00111111111100110111110100100010100","00011100000001100111110111111110100","00000001111001000111110000111110100","01111111001001010001000100000000000","01111111011001011111111100001111000","01011111010111000001000001111111100","01110000110111011101111111111100100","00100000100100010111010000000000100","00111011110111110000000000101111100","00001011110000000000111011101010000","00001000111110111000101010111011000","00001002011011101111101010000000000","00001001001101000100001011111111000","00001001001101110100011100100001000","00001001110001110000011111111111000","00011110010001011000011100000000000","00011011110000011000000000000000000","00000000000000000000000000000000000","00000000000000000000000000000000000"]},{dir:1,x:1,y:1,cells:["00000000000000000000","01111111101111101100","00001001111000111100","00111000100000100000","00000000000000100000","00011100000001111000","00011111111111111000","00011100000001111000","00001000000000000000","00002000000000000000","00000000000000000000"]},{dir:1,x:1,y:2,cells:["000000000000000","000100011111110","021113011111112","000100011111110","011111111101110","011000011111110","001100011111113","000100011111110","000100111111111","002100000010000","000111111110000","000000000000000"]}];var l;var k=n.user.map;if(k&&k.data){l=k.data}else{l=q[u]}var o=l.cells[0].length;var j=l.cells.length;this.init_current_map(o,j);this.dun.curDir=l.dir;this.dun.curX=l.x;this.dun.curY=l.y;this.dun.update_vec();for(var v=0;v<o;v++){for(var t=0;t<j;t++){var h=l.cells[t].charAt(v);switch(h){case"0":this.curmap[v][t].type=1;break;case"1":this.curmap[v][t].type=0;break;case"2":this.curmap[v][t].type=2;break;case"3":this.curmap[v][t].type=3;break}}}var g=this.get_map();var p=this.dun.g_disp;var w=this.dun.root_path;var r=this.dun.img_path;if(u==0){this.curmap[1][4+2].n.push(new f(b(this,["Go Left to Switch the lights<br/><img src='"+w+"/_Level1GFX/TurnLeft.png'/>","左に行き、<br/>スイッチを押して<br/>ください。<br/><img src='"+w+"/_Level1GFX/TurnLeft.png'/>"])));this.curmap[5][5+2].w.push(new f(b(this,["Right or left?","右か左か？"])));this.curmap[2][7+2].n.push(new f(b(this,["And there was light/dark",'<span style="color:black;text-decoration:underline">危険</span><br/>立入禁止'])));this.curmap[2][2+2].n.push(new f(b(this,["Walk right to open the door a jar",'<span style="color:black;text-decoration:underline">危険</span><br/>右の防護扉を<br/>開けてはいけない。'])));this.curmap[1][1+2].onWalkover=(new c(false,false,function(m){g[1][2+2].door.manualposition(1,2+2,80)}));this.create_door("",1,2+2,0,{image:"Iron"});this.create_door("",3,5+2,0,{image:"Wooden_window_rectangle"});this.create_door("",6,6+2,0,{image:"Wooden_window_semi_circle"});this.create_door("",3,8+2,0,{image:"Portcullis_window_semi_circle"});this.create_door("",13,6+2,0,{image:"Portcullis"});this.create_door("",18,11+2,0,{image:"Wooden"})}else{if(u==1){}else{if(u==2){this.create_door("",3,3,0,{image:"Portcullis",open:1});this.create_door("",4,4,0,{image:"Portcullis_window_rectangle",open:1});this.create_door("",10,9,0,{image:"Portcullis",open:1});this.curmap[3][1].onWalkover=(new c(false,false,function(m){p.Set_LightLevel(5)}));this.curmap[10][4].n.push(new f("Go Left to Switch the lights<br/><img src='"+w+"/_Level1GFX/TurnLeft.png'/>"));this.curmap[10][4].w.push(new f("Go Left to Switch the lights<br/><img src='"+w+"/_Level1GFX/TurnLeft.png'/>"))}}}return};JDMG_DungeonMap.prototype.create_random_map_o3compat=function(D,u,r){var E=this.dun;this.init_current_map(u,r);this.dun.curDir=2;this.dun.curX=1;this.dun.curY=1;this.dun.update_vec();var F=u*r;var h=new Array(F);for(var w=0;w<F;w++){h[w]=1}var o=1;var n=1;var m=0;var A=0;var s=0;var z=1;var k=2;var l=4;var g=8;for(var t=1;t<u-2;t+=2){for(var j=1;j<u-2;j+=2){o=j;n=t;while(1){m=0;if(o>=3&&h[o-2+n*u]==1){m|=g}if(o<=u-4&&h[o+2+n*u]==1){m|=k}if(n>=3&&h[o+(n-2)*u]==1){m|=z}if(n<=r-4&&h[o+(n+2)*u]==1){m|=l}if(s&&this.rand(15)<2){A=0;if(o>=3){A|=g}if(o<=u-4){A|=k}if(n>=3){A|=z}if(n<=r-4){A|=l}if(A&z){h[o+(n-1)*u]=0;h[o+(n-2)*u]=0}if(A&g){h[o-1+n*u]=0;h[o-2+n*u]=0}if(A&k){h[o+1+n*u]=0;h[o+2+n*u]=0}if(A&l){h[o+(n+1)*u]=0;h[o+(n+2)*u]=0}}if(m==0||s==-1){s=0;break}var v=0;while(1){v=this.rand(4);if(this.rand(10)<2){A=0;if(o>=3){A|=g}if(o<=u-4){A|=k}if(n>=3){A|=z}if(n<=r-4){A|=l}if(A&z&&v!=0){h[o+(n-1)*u]=0;h[o+(n-2)*u]=0}else{if(A&k&&v!=1){h[o+1+n*u]=0;h[o+2+n*u]=0}else{if(A&l&&v!=2){h[o+(n+1)*u]=0;h[o+(n+2)*u]=0}else{if(A&g&&v!=3){h[o-1+n*u]=0;h[o-2+n*u]=0}}}}}if(v==0){if(m&z){h[o+(n-1)*u]=0;h[o+(n-2)*u]=0;n-=2;s=1;break}}else{if(v==1){if(m&k){h[o+1+n*u]=0;h[o+2+n*u]=0;o+=2;s=1;break}}else{if(v==2){if(m&l){h[o+(n+1)*u]=0;h[o+(n+2)*u]=0;n+=2;s=1;break}}else{if(v==3){if(m&g){h[o-1+n*u]=0;h[o-2+n*u]=0;o-=2;s=1;break}}}}}}}}}h[(1)+(1)*u]=0;if(u>13&&r>13&&(E.floor==1||E.floor==-1)){var C=Math.floor(u/2)-3;var B=Math.floor(r/2)-3;for(var o=C;o<C+7;o++){for(var n=B;n<B+7;n++){if(o==C||n==B||o==C+6||n==B+6){h[o+n*u]=0}else{if(o==C+1||n==B+1||o==C+5||n==B+5){h[o+n*u]=1}else{h[o+n*u]=0}}}}h[(C+1)+(B+3)*u]=0;h[(C+5)+(B+3)*u]=0;h[(C+3)+(B+1)*u]=0;h[(C+3)+(B+5)*u]=0;this.create_door("",C+1,B+3,0,{image:"Wooden"});this.create_door("",C+5,B+3,0,{image:"Wooden_window_rectangle"});this.create_door("",C+3,B+1,0,{image:"Portcullis_window_rectangle"});this.create_door("",C+3,B+5,0,{image:"Portcullis_window_semi_circle"})}for(var w=0;w<=u;w++){var q=this.rand(u-2)+1;var p=this.rand(r-2)+1;if(h[q+p*u]==0&&h[(q-1)+(p-1)*u]==1&&h[(q+1)+(p-1)*u]==1&&h[(q-1)+(p+1)*u]==1&&h[(q+1)+(p+1)*u]==1){if((h[(q-1)+(p)*u]==0&&h[(q+1)+(p)*u]==0&&h[(q)+(p-1)*u]==1&&h[(q)+(p+1)*u]==1)||(h[(q-1)+(p)*u]==1&&h[(q+1)+(p)*u]==1&&h[(q)+(p-1)*u]==0&&h[(q)+(p+1)*u]==0)){this.create_door("",q,p,0,{image:"Portcullis_window_rectangle"})}}}return h};JDMG_DungeonMap.prototype.create_random_map_fix=function(h,j,s,q,o,t,r){var k=this.dun;var n=j*s;this.tmap=new Array(n);this.tgx=q;this.tgy=o;var p=q;var m=o;for(var l=0;l<s;l++){for(var g=0;g<j;g++){this.tmap[g+l*j]=this.curmap[g][l].type}}this.tmap[p+m*j]=0;return this.create_random_map_fix_core(j,s,p,m,t,r)};JDMG_DungeonMap.prototype.create_random_map_fix_core=function(k,h,g,n,m,l){if(this.tmap[(g)+(n)*k]==1){return 0}this.tmap[(g)+(n)*k]=1;if(g<1||n<1||g>=(k-1)||n>=(h-1)){return 0}if(g+n>this.tgx+this.tgy){this.tgx=g;this.tgy=n}if(g==m&&n==l){return 1}var j=0;if(this.tmap[(g+1)+(n)*k]==0){j+=this.create_random_map_fix_core(k,h,g+1,n,m,l)}if(this.tmap[(g-1)+(n)*k]==0){j+=this.create_random_map_fix_core(k,h,g-1,n,m,l)}if(this.tmap[(g)+(n+1)*k]==0){j+=this.create_random_map_fix_core(k,h,g,n+1,m,l)}if(this.tmap[(g)+(n-1)*k]==0){j+=this.create_random_map_fix_core(k,h,g,n-1,m,l)}return j};JDMG_DungeonMap.prototype.create_random_map=function(q,s){var n=this.dun;var k=n.user.map;this.srand((n.rand_seed+n.floor));var m=k.width;var w=k.height;if((!m)||m<5||m>=100||w<5||w>=100){m=17;w=17}if(s==0){var v=this.create_random_map_o3compat(k,m,w);var h=m-2;var p=w-2;var u=this.rand(3);var l=3-(m%2);var z=3-(w%2);if(m<17){l=0}if(w<17){z=0}var j;var g;if(u==0){j=h-l;g=p-z}else{if(u==1){j=1+l;g=p-z}else{if(u==2){j=h-l;g=1+z}}}if(m<20||this.rand(10)<5){if(m>13&&w>13&&(n.floor==1||n.floor==-1)){j=Math.floor(m/2);g=Math.floor(w/2)-1;v[(j+1)+(g)*m]=1;v[(j-1)+(g)*m]=1;v[j+(g-1)*m]=1;this.delete_door(j,g-1)}}v[j+(g)*m]=0;for(var t=0;t<m;t++){for(var r=0;r<w;r++){switch(v[t+r*m]){case 0:this.curmap[t][r].type=0;break;case 1:this.curmap[t][r].type=1;break}}}var o=this.create_random_map_fix(k,m,w,1,1,j,g);if(!o){j=this.tgx;g=this.tgy;this.dun.trace("FIX-MAP: x="+this.tgx+", y="+this.tgy)}if(n.tower){this.curmap[j][g].type=2;this.curmap[1][0].type=3}else{this.curmap[1][0].type=2;this.curmap[j][g].type=3}this.delete_door(j,g);this.dun.prevent_side_stepping_on_stairs=0;if(this.dun.stairs_before==this.curmap[1][0].type){this.dun.curX=j;this.dun.curY=g;if(this.curmap[j][g-1].type==0){this.dun.curDir=0}else{if(this.curmap[j][g+1].type==0){this.dun.curDir=2}else{if(this.curmap[j-1][g].type==0){this.dun.curDir=3}else{if(this.curmap[j+1][g].type==0){this.dun.curDir=1}}}}this.dun.update_vec()}}return 0};JDMG_DungeonMap.prototype.create_door=function(q,p,o,n,j){var m=this.dun;if(!q){q="door_"+p+"_"+o}var h;if(j.image){h='url("'+m.img_path+"door/"+j.image+'.png")'}else{h='url("'+m.img_path+'door/Portcullis.png")'}var g=0;var l=this.default_door_position;if(j.open){l=0}var k=false;return this.curmap[p][o].door=new JDMG_DungeonDoor(q,this.dun,g,l,k,h,n,p,o,{})};JDMG_DungeonMap.prototype.delete_door=function(h,g){if(this.curmap[h][g].door){delete this.curmap[h][g].door;this.curmap[h][g].door=null}};JDMG_DungeonMap.prototype.srand=function(g){if(this.dun.lm){math.random_init(g)}};JDMG_DungeonMap.prototype.rand=function(g){if(this.dun.lm){return parseInt(math.random()*g)}else{return parseInt(Math.random()*1024)%g}};function b(h,g){if(h&&h.dun&&h.dun.lm){return h.dun.lm._l(g)}else{if(h.dun&&h.dun.lang){return g[h.dun.lang]}else{return g[0]}}}}(window));(function(a){JDMG_Graphics_Compass=function(c,b){this.dun=c,this.div_id=b;this.prevDir=c.curDir};JDMG_Graphics_Compass.prototype.get_version=function(){return"1.0"};JDMG_Graphics_Compass.prototype.draw=function(b){if(this.prevDir==b){return}switch(b){case 0:$("#"+this.div_id+"_txt").html("Ｎ");if(this.prevDir==3){$("#"+this.div_id+"_arrow").css({transform:"rotate(0deg)",transition:"transform .0s"})}else{$("#"+this.div_id+"_arrow").css({transform:"rotate(0deg)",transition:"transform .1s"})}break;case 1:$("#"+this.div_id+"_txt").html("Ｅ");$("#"+this.div_id+"_arrow").css({transform:"rotate(90deg)",transition:"transform .1s"});break;case 2:$("#"+this.div_id+"_txt").html("Ｓ");$("#"+this.div_id+"_arrow").css({transform:"rotate(180deg)",transition:"transform .1s"});break;case 3:$("#"+this.div_id+"_txt").html("Ｗ");if(this.prevDir==0){$("#"+this.div_id+"_arrow").css({transform:"rotate(270deg)",transition:"transform .0s"})}else{$("#"+this.div_id+"_arrow").css({transform:"rotate(270deg)",transition:"transform .1s"})}break}this.prevDir=b}}(window));(function(b){JDMG_Graphics_Door=function(d){this.dun=d;this.door_div_name=[["Side1_1","Front1","Side1_2"],["Side2_1","Front2","Side2_2"],["Side3_1","Front3","Side3_2"]]};JDMG_Graphics_Door.prototype.get_version=function(){return"1.0"};JDMG_Graphics_Door.prototype.updateDoor=function(){c(this);a(this)};function a(j){var g=j.dun;var k=g.map.get_map();var m;var l;for(m=-1;m<=1;m++){for(l=3;l>0;l--){var e={};g.calculate_vec(m,-1*l,g.get_rotation(),e);if(g.map.is_overflow(g.curX+e.x,g.curY+e.y)){continue}var d=k[g.curX+e.x][g.curY+e.y];var h=d.door;if(h){var f="";switch(h.state){case 0:if(h.innerGraphic!=null){f=h.innerGraphic}break;case 1:if(h.innerGraphic2!=null){f=h.innerGraphic2}break;case 2:if(h.innerGraphic3!=null){f=h.innerGraphic3}break}var n=k[g.curX+e.x+g.vx][g.curY+e.y+g.vy];if(n&&n.type!=1){if(l==1){$(".door"+j.door_div_name[l-1][m+1]+"_inner").css({"background-size":"182px 166px","background-image":f})}else{if(l==2){$(".door"+j.door_div_name[l-1][m+1]+"_inner").css({"background-size":"122px 111px","background-image":f})}else{if(l==3){$(".door"+j.door_div_name[l-1][m+1]+"_inner").css({"background-size":"95px 85px","background-image":f})}else{g.trace("Graphic_Door:door().Invalid vy="+l+".")}}}g.g_disp.disblock(".door"+j.door_div_name[l-1][m+1]+"");g.g_disp.disblock(".door"+j.door_div_name[l-1][m+1]+"_inner");g.g_disp.disblock(".door"+j.door_div_name[l-1][m+1]+"_button");if(l==1){$(".door"+j.door_div_name[l-1][m+1]+"_inner").css("height",h.position+"px");if(m==0){var o=h;$(".door"+j.door_div_name[l-1][m+1]+"_button").click(function(){o.openclose();g.sound_effect(24)})}}else{if(l==2){$(".door"+j.door_div_name[l-1][m+1]+"_inner").css("height",Math.floor(h.position*(125/181))+"px")}else{if(l==3){$(".door"+j.door_div_name[l-1][m+1]+"_inner").css("height",Math.floor(h.position*(95/181))+"px")}}}}}else{g.g_disp.hideblock(".door"+j.door_div_name[l-1][m+1]+"");g.g_disp.hideblock(".door"+j.door_div_name[l-1][m+1]+"_inner");g.g_disp.hideblock(".door"+j.door_div_name[l-1][m+1]+"_button");g.g_disp.clearevents(".door"+j.door_div_name[l-1][m+1]+"_button")}}}}function c(e){var d=e.dun;$("div[class*=door]").css("display","none");d.g_disp.clearevents(".doorFront1_button");d.g_disp.clearevents(".doorFront2_button");d.g_disp.clearevents(".doorSide2_1_button")}}(window));(function(b){JDMG_Dungeon=function(f,e,d,c){this.div_id=f;this.root_path=e;this.img_path=e+"/_img/";if(c){this.lm=c}else{if(typeof(lm)!="undefined"&&lm){this.lm=lm}else{if(parent.lm){this.lm=parent.lm}}}this.ls_version=1;this.ls_ver=this.ls_version;this.uid=d;if(this.lm){this.plugin=new JDMG_Plugin(this,this.lm)}};JDMG_Dungeon.prototype.get_version=function(){return"4.0"};JDMG_Dungeon.prototype.start=function(c){this.user=c;if(this.user.lang){this.lang=this.user.lang}else{this.lang=0}if(this.user.uid){this.uid=this.user.uid}else{if(!this.uid){this.uid="anonymous"}}this.debug=0;if(this.lm){this.debug=this.lm.debug_get();this.trace("cname:"+this.user.cname);this.trace("light:"+this.user.light);this.trace("compass:"+this.user.compass);this.trace("automap:"+this.user.automap)}else{if(this.user.debug==1){this.debug=1}}if(this.plugin){this.plugin.setup_LocalStorage()}if(this.user.rand_seed){this.rand_seed=this.user.rand_seed}this.use_sound=1;this.use_sound_effect=1;if(this.plugin){this.use_sound=this.plugin.bgm_status()}else{if(!this.user.sound){this.use_sound=0;this.use_sound_effect=0}}this.curDir=0;this.vx=0;this.vy=-1;this.curX=1;this.curY=1;this.finished=0;this.total_steps=0;this.encounting=0;this.last_mons_x=0;this.last_mons_y=0;this.find_new_block=0;this.stairs_before=0;this.prevent_side_stepping_on_stairs=1;this.html=new JDMG_Graphics_HTML(this,this.div_id);this.html.draw();this.compass=new JDMG_Graphics_Compass(this,this.html.get_compass_div_id());this.mov=new JDMG_DungeonMovement(this);this.g_disp=new JDMG_GraphicsDisplay(this);this.g_door=new JDMG_Graphics_Door(this);this.map=new JDMG_DungeonMap(this,this.html.get_map_div_id());if(this.user.map){this.map.setup(1,this.user.map)}else{this.map.setup(1,null)}this.resume_saved_data();if(!this.user.compass){$("#"+this.html.get_compass_div_id()).hide()}this.light=Math.floor(this.user.light);this.light_total=this.light;this.update_light();if(this.user.automap>0){this.automap=1}else{this.automap=0}if(this.lm){this.automap=1}this.redraw(1);this.g_disp.doStep();this.checkEvent();if(this.lm&&this.parent_cid){if(!this.run_evid){this.run_evid=this.lm.contents_register_update_handler(this.parent_cid,5000,this._run_thread,this,"")}}};JDMG_Dungeon.prototype.stop=function(){if(this.lm){this.lm.contents_unregister_update_handler(this.run_evid);this.run_evid=0}};JDMG_Dungeon.prototype._run_thread=function(){var c=this.light_total;this.update_light(1);if(c!=this.light_total){this.redraw()}};JDMG_Dungeon.prototype.enable_kbd=function(){$(document).on("keydown",function(c){var g=dun;var d=38;var h=40;var j=37;var k=39;var f=87;var n=83;var e=65;var m=68;var l=81;var o=69;if(c.preventDefault){c.preventDefault()}g.trace("JDMG_Dungeon.run():kecCode="+c.keyCode+", which="+c.which);switch(c.keyCode){case d:case f:g.mov.moveMe("u");break;case h:case n:g.mov.moveMe("d");break;case e:g.mov.moveMe("l");break;case m:g.mov.moveMe("r");break;case j:if(c.shiftKey||c.ctrlKey){g.mov.moveMe("l")}else{g.mov.moveMe("l90")}break;case k:if(c.shiftKey||c.ctrlKey){g.mov.moveMe("r")}else{g.mov.moveMe("r90")}break;case l:g.mov.moveMe("l90");break;case o:g.mov.moveMe("r90");break}})};JDMG_Dungeon.prototype.disable_kbd=function(){$(document).off("keydown")};JDMG_Dungeon.prototype.store_save_data=function(){if(this.plugin){this.plugin.store_SaveData()}};JDMG_Dungeon.prototype.resume_saved_data=function(){if(this.plugin){this.plugin.resume_SavedData()}};JDMG_Dungeon.prototype.erase_saved_data=function(){if(this.plugin){this.plugin.erase_SavedData()}};JDMG_Dungeon.prototype.checkEvent=function(d){var e=this;var c=e.map.get_map();if(c[e.curX][e.curY]&&c[e.curX][e.curY].onWalkover!=null){if(c[e.curX][e.curY].onWalkover.onEvent_runonce&&!c[e.curX][e.curY].onWalkover.onEvent_hasrun){c[e.curX][e.curY].onWalkover.myEvent(d);c[e.curX][e.curY].onWalkover.onEvent_hasrun=true;if(c[e.curX][e.curY].onWalkover.myCallback!=null){c[e.curX][e.curY].onWalkover.myCallback()}}else{if(!c[e.curX][e.curY].onWalkover.onEvent_runonce){c[e.curX][e.curY].onWalkover.myEvent(d);if(c[e.curX][e.curY].onWalkover.myCallback!=null){c[e.curX][e.curY].onWalkover.myCallback()}}}}};JDMG_Dungeon.prototype.into_stairs=function(c){var e=0;if(this.total_floors>0){this.stairs_before=c.type;if(((this.tower)&&c.type==2)||((!this.tower)&&c.type==3)){if(this.floor<0){if(this.floors_d_state){this.floors_d_state[this.floor*-1]=1}}else{if(this.floors_u_state){this.floors_u_state[this.floor]=1}}}if(c.type==2){this.floor++}else{this.floor--}if(this.floor!=this.out_floor&&this.floor!=this.event_floor){this.map.setup(0,this.user.map);this.redraw();return}if(this.floor==this.out_floor){e=1}}else{var d=2;if(c.type==d){e=1}}if(this.plugin){this.plugin.into_stairs(e)}else{if(this.total_floors>0){this.floor=this.start_floor}}};JDMG_Dungeon.prototype.get_rotation=function(){switch(this.curDir){case 0:return 0;case 1:return -90;case 2:return 180;case 3:return 90}};JDMG_Dungeon.prototype.calculate_vec=function(g,f,d,e){var c=(d*Math.PI)/180;e.x=(g*Math.cos(c)|0)+(f*Math.sin(c)|0);e.y=(f*Math.cos(c)|0)-(g*Math.sin(c)|0);return};JDMG_Dungeon.prototype.update_vec=function(d){var c;if(d==90){c=this.vx;this.vx=this.vy;this.vy=-1*c}else{if(d==-90){c=this.vx;this.vx=-1*this.vy;this.vy=c}else{switch(this.curDir){case 0:this.vx=0;this.vy=-1;break;case 1:this.vx=1;this.vy=0;break;case 2:this.vx=0;this.vy=1;break;case 3:this.vx=-1;this.vy=0;break}}}return};JDMG_Dungeon.prototype.update=function(c){var d=this;if(this.finished){return}if(c){this.total_steps++;this.map.steps++}if(this.plugin){this.plugin.update()}this.store_save_data();this.redraw()};JDMG_Dungeon.prototype.redraw=function(c){if($("#"+this.html.get_compass_div_id()).css("display")!="none"){this.compass.draw(this.curDir)}this.update_tools();this.update_light();this.g_disp.Set_LightLevel(this.light_total);this.auto_mapping();if(this.light_total>0){if(this.automap>0){this.show_map();this.map.draw_map()}this.g_disp.updateViewport()}else{this.hide_map()}return};JDMG_Dungeon.prototype.auto_mapping=function(){if(1){var g=this.map.get_map();var f=1;this.update_vec();for(var d=-1;d<=3;d++){for(var j=0;j<=2;j++){if(d==-1&&e!=0){continue}if(f){var e=j;if(e==2){e=-1}var c={};this.calculate_vec(e,-1*d,this.get_rotation(),c);if(this.map.is_overflow(this.curX+c.x,this.curY+c.y)){continue}if(e==0&&d>0&&(g[this.curX+c.x][this.curY+c.y].type==1||g[this.curX+c.x][this.curY+c.y].door)){for(var h=-1;h<=1;h++){if((!this.map.is_overflow(this.curX,this.curY+h))&&g[this.curX+0][this.curY+h].type==0){if(!this.map.is_overflow(this.curX+1,this.curY+h)&&!this.map.map_mask[(this.curY+h)*this.map.width+(this.curX+1)]){this.find_new_block++;this.map.map_mask[(this.curY+h)*this.map.width+(this.curX+1)]=1}if(!this.map.is_overflow(this.curX-1,this.curY+h)&&!this.map.map_mask[(this.curY+h)*this.map.width+(this.curX-1)]){this.find_new_block++;this.map.map_mask[(this.curY+h)*this.map.width+(this.curX-1)]=1}}}f=0}if(!this.map.map_mask[(this.curY+c.y)*this.map.width+(this.curX+c.x)]){this.find_new_block++;this.map.map_mask[(this.curY+c.y)*this.map.width+(this.curX+c.x)]=1}}}}}};JDMG_Dungeon.prototype.update_tools=function(c){var g=this;if(g.lm){var f=g.lm.obj("item1");if(f){var e=f.iv_search("automap");if(e>0){this.user.automap=e;$("#"+this.html.get_map_div_id()+"_btn").show();this.map.draw_map()}else{this.user.automap=0;$("#"+this.html.get_map_div_id()+"_btn").hide()}if(this.user.compass==2){$("#"+this.html.get_compass_div_id()).show()}else{var d=f.iv_search("compass");if(d>0){this.user.compass=d;$("#"+this.html.get_compass_div_id()).show()}else{this.user.compass=0;$("#"+this.html.get_compass_div_id()).hide()}}}}};JDMG_Dungeon.prototype.update_light=function(e){var j=this;if(j.lm){var h=j.lm.obj("item1");if(h){var d=h.get_light_level();if(d>=0){this.light=d}}}var c=this.light;if(c<this.map.map_default_light){c+=this.map.map_default_light}var f=j.map.get_map();var g=0;if(f[j.curX][j.curY]){g=f[j.curX][j.curY].light;if(f[j.curX][j.curY].light_add){c+=g}if(f[j.curX][j.curY].light_del){c-=g}if(f[j.curX][j.curY].light){c=g}}if(!e){j.trace("Dungeon:update_light():Item.level="+this.light+", map_level="+this.map.map_default_light+", cell="+g+", total="+c)}this.light_total=c};JDMG_Dungeon.prototype.toggle_div=function(c){if($(c).css("display")=="none"){$(c).css("display","inline-block")}else{$(c).css("display","none")}return};JDMG_Dungeon.prototype.show_map=function(){$("#"+this.html.get_map_div_id()).css({display:"inline-block"})};JDMG_Dungeon.prototype.hide_map=function(){$("#"+this.html.get_map_div_id()).css({display:"none"})};JDMG_Dungeon.prototype.toggle_map=function(){var c="#"+this.html.get_map_div_id();if($(c).css("display")=="none"){this.automap=1;$(c).css("display","inline-block")}else{this.automap=0;$(c).css("display","none")}return};JDMG_Dungeon.prototype.my_alert=function(c){if(typeof(lm)!="undefined"&&lm.obj("alert")){lm.obj("alert").show([c],{})}else{if(parent.lm){parent.lm.obj("alert").show([c],{})}else{alert(c)}}return};JDMG_Dungeon.prototype.my_help=function(c){if(typeof(lm)!="undefined"&&lm.obj("alert")){lm.obj("alert").show([c],{})}else{if(parent.lm){parent.lm.obj("alert").show([c],{})}else{this.toggle_div("#"+this.html.get_help_div_id())}}return};JDMG_Dungeon.prototype.sound=function(c){if(this.use_sound){if(this.plugin){this.plugin.sound(c)}else{var e="./_sound/"+c+".mp3";var d=document.getElementById("dummyspan");if(d){d.innerHTML="<embed src='"+e+"' hidden=true autostart=true loop=false>"}}}return};JDMG_Dungeon.prototype.sound_effect=function(c){if(this.use_sound_effect){if(this.plugin){this.plugin.sound_effect(c)}else{var e="./_sound_effect/"+c+".mp3";var d=document.getElementById("dummyspan");if(d){d.innerHTML="<embed src='"+e+"' hidden=true autostart=true loop=false>"}}}return};JDMG_Dungeon.prototype.is_debug=function(){return this.debug};JDMG_Dungeon.prototype.dbg=function(c){document.getElementById("dbug").innerHTML+="<br/>"+c;return};JDMG_Dungeon.prototype.trace=function(c){if(this.debug){console.log(c)}return};JDMG_Dungeon.prototype.is_root=function(){if(this.plugin){return this.plugin.is_root()}return 0};JDMG_Dungeon.prototype.is_auth=function(){if(this.plugin){return this.plugin.is_auth()}return 0};function a(c){hu=b.location.search.substring(1);gy=hu.split("&");for(i=0;i<gy.length;i++){ft=gy[i].split("=");if(ft[0]==c){return ft[1]}}return""}}(window));